async function submitAllOperations(){
  if(batchOperations.length === 0) return;

  const submitBtn = document.getElementById('submitAllBatch');
  const originalText = submitBtn.textContent;
  submitBtn.disabled = true;
  submitBtn.textContent = 'Processing...';

  const results = [];
  let successCount = 0;
  let errorCount = 0;

  for(let operation of batchOperations) {
    try {
      const response = await fetch(`${API.url}?code=${API.key}`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(operation)
      });

      if(response.ok) {
        const result = await response.json();
        results.push({
          operation: operation,
          success: true,
          message: result.message || `${operation.action} successful`
        });
        successCount++;
      } else {
        const error = await response.json();
        results.push({
          operation: operation,
          success: false,
          message: error.error || 'Unknown error'
        });
        errorCount++;
      }
    } catch(error) {
      results.push({
        operation: operation,
        success: false,
        message: error.message || 'Network error'
      });
      errorCount++;
    }
  }

  displayBatchResults(results, successCount, errorCount);
  batchOperations = batchOperations.filter(op => 
    !results.find(r => r.operation.id === op.id && r.success)
  );

  updateBatchTable();
  populatePhoneDropdowns();

  submitBtn.disabled = false;
  submitBtn.textContent = originalText;

  // Force tab reload after processing is complete
  // Multiple reload methods for Teams iframe compatibility
  setTimeout(() => {
    try {
      // Method 1: Standard reload
      window.location.reload(true);
    } catch(e) {
      try {
        // Method 2: Force reload with timestamp
        window.location.href = window.location.href + '?reload=' + Date.now();
      } catch(e2) {
        try {
          // Method 3: Parent window reload (if accessible)
          if (window.parent && window.parent !== window) {
            window.parent.location.reload(true);
          }
        } catch(e3) {
          // Method 4: Hard refresh attempt
          window.location.replace(window.location.href);
        }
      }
    }
  }, 2000); // 2-second delay to show results before reload
}
