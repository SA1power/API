<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>MSOE Teams Provisioning Portal</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:Arial,sans-serif;background:#f5f5f5;padding:20px}
    .container{max-width:1600px;margin:0 auto}
    .tab-navigation{display:flex;background:#fff;border:1px solid #ddd;border-radius:4px 4px 0 0;margin-bottom:0}
    .tab-button{flex:1;padding:15px 20px;background:#f8f9fa;border:none;border-right:1px solid #ddd;cursor:pointer;font-weight:bold;transition:all 0.3s}
    .tab-button:last-child{border-right:none}
    .tab-button:hover{background:#e9ecef}
    .tab-button.active{background:#c41e3a;color:white}
    .tab-content{display:none;background:#f5f5f5;border:1px solid #ddd;border-top:none;border-radius:0 0 4px 4px;padding:20px}
    .tab-content.active{display:block}
    .main-layout{display:flex;gap:20px;flex-wrap:wrap}
    .left-panel{flex:2;min-width:800px}
    .right-panel{flex:1;min-width:400px}
    .columns{display:flex;gap:20px;flex-wrap:wrap}
    .column{flex:1;background:#e8e8e8;border:2px solid #999;border-radius:4px;padding:20px;display:flex;flex-direction:column;min-width:300px}
    .column-header{background:#d0d0d0;margin:-20px -20px 20px -20px;padding:10px 20px;font-weight:bold;border-bottom:1px solid #999}
    .form-group{margin-bottom:15px}
    .form-group label{display:block;margin-bottom:5px;font-weight:bold}
    .form-control{width:100%;padding:8px;border:1px solid #999;border-radius:4px}
    .btn{padding:8px 15px;border:none;border-radius:4px;cursor:pointer;margin-top:auto}
    .btn-primary{background:#c41e3a;color:#fff}
    .btn-primary:disabled{background:#ccc;cursor:not-allowed}
    .btn-success{background:#28a745;color:#fff}
    .btn-success:hover{background:#218838}
    .batch-panel{background:#f0f8ff;border:2px solid #4169e1;border-radius:4px;padding:20px}
    .batch-header{background:#4169e1;color:white;margin:-20px -20px 20px -20px;padding:10px 20px;font-weight:bold;border-bottom:1px solid #4169e1}
    .batch-table{width:100%;border-collapse:collapse;margin-bottom:20px}
    .batch-table th,.batch-table td{border:1px solid #ddd;padding:8px;text-align:left}
    .batch-table th{background:#e6f2ff;font-weight:bold}
    .batch-empty{text-align:center;color:#666;font-style:italic;padding:20px}
    .naming-preview{background:#f0f8ff;border:1px solid #0066cc;padding:10px;border-radius:4px;margin-top:10px}
    .naming-preview h5{color:#0066cc;margin-bottom:5px}
    .naming-item{font-family:monospace;font-size:12px;margin:3px 0}
    .success{background:#e6ffe6;color:#006600;padding:10px;border:1px solid #006600;border-radius:4px;margin-bottom:15px}
    @media(max-width:1200px){.main-layout{flex-direction:column}.left-panel,.right-panel{min-width:auto}}
  </style>
</head>
<body>
<div class="container">
  <!-- Status -->
  <div id="teamsStatus" class="teams-status">ðŸ”„ Initializing Teams integration...</div>

  <!-- Tabs -->
  <div class="tab-navigation">
    <button class="tab-button" onclick="showTab('phone-users', event)">Teams Phone Users</button>
    <button class="tab-button" onclick="showTab('shared-devices', event)">Teams Shared Devices</button>
    <button class="tab-button" onclick="showTab('call-queues', event)">Call Queues</button>
    <button class="tab-button" onclick="showTab('auto-attendants', event)">Auto Attendants</button>
    <button class="tab-button" onclick="showTab('aa-cq-pairs', event)">AA/CQ Pairs</button>
  </div>

  <!-- Call Queues -->
  <div id="call-queues" class="tab-content">
    <div class="main-layout">
      <div class="left-panel">
        <div class="columns">
          <div class="column">
            <div class="column-header">Add a Call Queue</div>
            <div id="cqMessages"></div>
            <div class="form-group">
              <label for="cqBaseName">Base Name:</label>
              <input id="cqBaseName" class="form-control" placeholder="e.g., Admissions"/>
            </div>
            <div class="form-group">
              <label for="cqPhoneNumber">Phone Number:</label>
              <select id="cqPhoneNumber" class="form-control"><option value="">Loading...</option></select>
            </div>
            <div class="naming-preview" id="cqPreview">
              <h5>Preview:</h5>
              <div class="naming-item" id="cqUPN"></div>
              <div class="naming-item" id="cqDisplay"></div>
            </div>
            <button id="addCQSubmit" class="btn btn-primary" disabled>Add to Batch Queue</button>
          </div>
        </div>
      </div>
      <div class="right-panel">
        <div class="batch-panel">
          <div class="batch-header">Batch Queue - Call Queues</div>
          <div id="cqBatchEmpty" class="batch-empty">No Call Queues queued.</div>
          <table id="cqBatchTable" class="batch-table" style="display:none">
            <thead><tr><th>Name</th><th>UPN</th><th>Phone</th></tr></thead>
            <tbody id="cqBatchBody"></tbody>
          </table>
          <button id="submitAllCQs" class="btn btn-success" style="display:none">Submit All</button>
          <div id="cqResults"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Auto Attendants -->
  <div id="auto-attendants" class="tab-content">
    <div class="main-layout">
      <div class="left-panel">
        <div class="columns">
          <div class="column">
            <div class="column-header">Add an Auto Attendant</div>
            <div id="aaMessages"></div>
            <div class="form-group">
              <label for="aaBaseName">Base Name:</label>
              <input id="aaBaseName" class="form-control" placeholder="e.g., Admissions"/>
            </div>
            <div class="form-group">
              <label for="aaPhoneNumber">Phone Number:</label>
              <select id="aaPhoneNumber" class="form-control"><option value="">Loading...</option></select>
            </div>
            <div class="naming-preview" id="aaPreview">
              <h5>Preview:</h5>
              <div class="naming-item" id="aaUPN"></div>
              <div class="naming-item" id="aaDisplay"></div>
            </div>
            <button id="addAASubmit" class="btn btn-primary" disabled>Add to Batch Queue</button>
          </div>
        </div>
      </div>
      <div class="right-panel">
        <div class="batch-panel">
          <div class="batch-header">Batch Queue - Auto Attendants</div>
          <div id="aaBatchEmpty" class="batch-empty">No Auto Attendants queued.</div>
          <table id="aaBatchTable" class="batch-table" style="display:none">
            <thead><tr><th>Name</th><th>UPN</th><th>Phone</th></tr></thead>
            <tbody id="aaBatchBody"></tbody>
          </table>
          <button id="submitAllAAs" class="btn btn-success" style="display:none">Submit All</button>
          <div id="aaResults"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pairs -->
  <div id="aa-cq-pairs" class="tab-content">
    <div class="main-layout">
      <div class="left-panel">
        <div class="columns">
          <div class="column">
            <div class="column-header">Add AA/CQ Pair</div>
            <div id="pairMessages"></div>
            <div class="form-group">
              <label for="pairBaseName">Base Name:</label>
              <input id="pairBaseName" class="form-control" placeholder="e.g., Admissions"/>
            </div>
            <div class="form-group">
              <label for="pairPhoneNumber">Phone Number:</label>
              <select id="pairPhoneNumber" class="form-control"><option value="">Loading...</option></select>
            </div>
            <div class="naming-preview" id="pairPreview">
              <h5>Preview:</h5>
              <div class="naming-item" id="pairCQUPN"></div>
              <div class="naming-item" id="pairCQDisplay"></div>
              <div class="naming-item" id="pairAAUPN"></div>
              <div class="naming-item" id="pairAADisplay"></div>
            </div>
            <button id="addPairSubmit" class="btn btn-primary" disabled>Add to Batch Queue</button>
          </div>
        </div>
      </div>
      <div class="right-panel">
        <div class="batch-panel">
          <div class="batch-header">Batch Queue - AA/CQ Pairs</div>
          <div id="pairBatchEmpty" class="batch-empty">No Pairs queued.</div>
          <table id="pairBatchTable" class="batch-table" style="display:none">
            <thead><tr><th>Name</th><th>CQ UPN</th><th>AA UPN</th><th>Phone</th></tr></thead>
            <tbody id="pairBatchBody"></tbody>
          </table>
          <button id="submitAllPairs" class="btn btn-success" style="display:none">Submit All</button>
          <div id="pairResults"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const API = { url: 'https://availablephonenumberapi.azurewebsites.net/api/GetAvailablePhoneNumbers', key: 'NULL' };
let cqBatch=[], aaBatch=[], pairBatch=[];

// Tab switching
function showTab(name,e){document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));document.querySelectorAll('.tab-button').forEach(b=>b.classList.remove('active'));document.getElementById(name).classList.add('active');e.target.classList.add('active');}

// Live previews
document.addEventListener('input',e=>{
  if(e.target.id==='cqBaseName'){let n=e.target.value.trim().toLowerCase();document.getElementById('cqUPN').textContent=n?`UPN: q_${n}@msoe.edu`:'';document.getElementById('cqDisplay').textContent=n?`Display: Q ${n}`:'';document.getElementById('addCQSubmit').disabled=!n;}
  if(e.target.id==='aaBaseName'){let n=e.target.value.trim().toLowerCase();document.getElementById('aaUPN').textContent=n?`UPN: call_${n}@msoe.edu`:'';document.getElementById('aaDisplay').textContent=n?`Display: Call ${n}`:'';document.getElementById('addAASubmit').disabled=!n;}
  if(e.target.id==='pairBaseName'){let n=e.target.value.trim().toLowerCase();document.getElementById('pairCQUPN').textContent=n?`CQ UPN: q_${n}@msoe.edu`:'';document.getElementById('pairCQDisplay').textContent=n?`CQ Display: Q ${n}`:'';document.getElementById('pairAAUPN').textContent=n?`AA UPN: call_${n}@msoe.edu`:'';document.getElementById('pairAADisplay').textContent=n?`AA Display: Call ${n}`:'';document.getElementById('addPairSubmit').disabled=!n;}
});

// Add to batch
document.getElementById('addCQSubmit').onclick=()=>{let n=document.getElementById('cqBaseName').value.trim();let p=document.getElementById('cqPhoneNumber').value; cqBatch.push({action:'WriteCQs',CallQueueName:n,PhoneNumber:p});renderBatch('cq');};
document.getElementById('addAASubmit').onclick=()=>{let n=document.getElementById('aaBaseName').value.trim();let p=document.getElementById('aaPhoneNumber').value; aaBatch.push({action:'WriteAAs',AA_Name:n,PhoneNumber:p});renderBatch('aa');};
document.getElementById('addPairSubmit').onclick=()=>{let n=document.getElementById('pairBaseName').value.trim();let p=document.getElementById('pairPhoneNumber').value; pairBatch.push({action:'WriteCQAAPairs',BaseName:n,PhoneNumber:p});renderBatch('pair');};

// Render batch tables
function renderBatch(type){if(type==='cq'){let t=document.getElementById('cqBatchBody');t.innerHTML='';cqBatch.forEach(r=>{t.innerHTML+=`<tr><td>${r.CallQueueName}</td><td>q_${r.CallQueueName}@msoe.edu</td><td>${r.PhoneNumber}</td></tr>`});document.getElementById('cqBatchEmpty').style.display=cqBatch.length?'none':'block';document.getElementById('cqBatchTable').style.display=cqBatch.length?'table':'none';document.getElementById('submitAllCQs').style.display=cqBatch.length?'block':'none';}
if(type==='aa'){let t=document.getElementById('aaBatchBody');t.innerHTML='';aaBatch.forEach(r=>{t.innerHTML+=`<tr><td>${r.AA_Name}</td><td>call_${r.AA_Name}@msoe.edu</td><td>${r.PhoneNumber}</td></tr>`});document.getElementById('aaBatchEmpty').style.display=aaBatch.length?'none':'block';document.getElementById('aaBatchTable').style.display=aaBatch.length?'table':'none';document.getElementById('submitAllAAs').style.display=aaBatch.length?'block':'none';}
if(type==='pair'){let t=document.getElementById('pairBatchBody');t.innerHTML='';pairBatch.forEach(r=>{t.innerHTML+=`<tr><td>${r.BaseName}</td><td>q_${r.BaseName}@msoe.edu</td><td>call_${r.BaseName}@msoe.edu</td><td>${r.PhoneNumber}</td></tr>`});document.getElementById('pairBatchEmpty').style.display=pairBatch.length?'none':'block';document.getElementById('pairBatchTable').style.display=pairBatch.length?'table':'none';document.getElementById('submitAllPairs').style.display=pairBatch.length?'block':'none';}}

// Submit all
document.getElementById('submitAllCQs').onclick=()=>submitBatch(cqBatch,'cqResults');
document.getElementById('submitAllAAs').onclick=()=>submitBatch(aaBatch,'aaResults');
document.getElementById('submitAllPairs').onclick=()=>submitBatch(pairBatch,'pairResults');

async function submitBatch(batch,resultDiv){if(!batch.length)return;try{let r=await fetch(`${API.url}?code=${API.key}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(batch[0])});let j=await r.json();document.getElementById(resultDiv).innerHTML=`<div class="success">${JSON.stringify(j)}</div>`;}catch(e){document.getElementById(resultDiv).innerHTML=`<div class="error">${e}</div>`;}}

// Load phone numbers
async function loadPhoneNumbers(){let r=await fetch(`${API.url}?code=${API.key}`);let nums=await r.json();let sels=[document.getElementById('cqPhoneNumber'),document.getElementById('aaPhoneNumber'),document.getElementById('pairPhoneNumber')];sels.forEach(sel=>{sel.innerHTML='<option value="">-- Select --</option>';nums.forEach(n=>{sel.innerHTML+=`<option value="${n.AvailablePhoneNumber}">${n.AvailablePhoneNumber}</option>`})});}
loadPhoneNumbers();
</script>
</body>
</html>
