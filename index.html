<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSOE Teams Phone System Numbers</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px 0;
        }

        .logo {
            width: 80px;
            height: 80px;
            background-color: #c41e3a;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            border-radius: 4px;
        }

        .logo-text {
            color: white;
            font-weight: bold;
            font-size: 24px;
            letter-spacing: -1px;
        }

        .title {
            font-size: 32px;
            color: #333;
            font-weight: normal;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .panel {
            background-color: #e8e8e8;
            border: 2px solid #999;
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .panel-header {
            background-color: #d0d0d0;
            margin: -20px -20px 20px -20px;
            padding: 10px 20px;
            font-weight: bold;
            font-size: 16px;
            color: #333;
            border-bottom: 1px solid #999;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .dropdown {
            width: 100%;
            max-width: 300px;
            padding: 8px 12px;
            border: 1px solid #999;
            border-radius: 4px;
            background-color: white;
            font-size: 14px;
            color: #333;
        }

        .dropdown:focus {
            outline: none;
            border-color: #c41e3a;
            box-shadow: 0 0 5px rgba(196, 30, 58, 0.3);
        }

        .phone-list {
            background-color: white;
            border: 1px solid #999;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
        }

        .phone-number {
            padding: 8px 12px;
            border-bottom: 1px solid #eee;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #333;
        }

        .phone-number:last-child {
            border-bottom: none;
        }

        .phone-number:nth-child(even) {
            background-color: #f9f9f9;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }

        .error {
            color: #c41e3a;
            padding: 10px;
            background-color: #ffe6e6;
            border: 1px solid #c41e3a;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .success {
            color: #006600;
            padding: 10px;
            background-color: #e6ffe6;
            border: 1px solid #006600;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .select-button {
            background-color: #c41e3a;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 15px;
        }

        .select-button:hover {
            background-color: #a01729;
        }

        .select-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .selected-number {
            font-weight: bold;
            color: #c41e3a;
            font-size: 16px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <div class="logo-text">MSOE</div>
            </div>
            <h1 class="title">MSOE Teams Phone System Numbers</h1>
        </div>

        <div class="panel">
            <div class="panel-header">Available Phone Numbers</div>
            
            <div id="errorMessage" class="error" style="display: none;"></div>
            <div id="successMessage" class="success" style="display: none;"></div>
            
            <div class="form-group">
                <label for="phoneDropdown">Available Phone Numbers:</label>
                <select id="phoneDropdown" class="dropdown">
                    <option value="">Loading phone numbers...</option>
                </select>
                <button id="selectButton" class="select-button" disabled>Submit</button>
            </div>

            <div id="selectedNumber" class="selected-number" style="display: none;"></div>
        </div>

        <div class="panel">
            <div class="panel-header">Non-Provisioned Phone Numbers</div>
            <div id="phoneList" class="phone-list">
                <div class="loading">Loading available phone numbers...</div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_CONFIG = {
            functionUrl: 'https://availablephonenumberapi.azurewebsites.net/api/GetAvailablePhoneNumbers',
            functionKey: 'EsQlM7c0jssk1pzk83F5IYFV6SkZm6AXto3KSbXSA4JlAzFuN7cgbw=='
        };

        // Global variables
        let availableNumbers = [];
        let selectedNumber = null;

        // DOM elements
        const phoneDropdown = document.getElementById('phoneDropdown');
        const selectButton = document.getElementById('selectButton');
        const phoneList = document.getElementById('phoneList');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');
        const selectedNumberDiv = document.getElementById('selectedNumber');

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadPhoneNumbers();
            setupEventListeners();
        });

        function setupEventListeners() {
            phoneDropdown.addEventListener('change', function() {
                const selected = this.value;
                selectButton.disabled = !selected;
                selectedNumber = selected;
            });

            selectButton.addEventListener('click', function() {
                if (selectedNumber) {
                    selectPhoneNumber(selectedNumber);
                }
            });
        }

        async function loadPhoneNumbers() {
            try {
                showLoading(true);
                hideMessages();

                const response = await fetch(`${API_CONFIG.functionUrl}?code=${API_CONFIG.functionKey}`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const data = await response.json();
                
                // Filter numbers that start with "1414277"
                availableNumbers = data.filter(item => 
                    item.AvailablePhoneNumber && 
                    item.AvailablePhoneNumber.startsWith('1414277')
                );

                populateDropdown(availableNumbers);
                displayPhoneNumbers(availableNumbers);
                
            } catch (error) {
                console.error('Error loading phone numbers:', error);
                showError(`Failed to load phone numbers: ${error.message}`);
                phoneDropdown.innerHTML = '<option value="">Error loading numbers</option>';
                phoneList.innerHTML = '<div class="error">Failed to load phone numbers</div>';
            } finally {
                showLoading(false);
            }
        }

        function generateMockData() {
            // Generate mock data similar to your screenshot
            const mockNumbers = [];
            for (let i = 10; i <= 33; i++) {
                mockNumbers.push({
                    AvailablePhoneNumber: `141422177${i.toString().padStart(2, '0')}`,
                    NumberType: 'Direct Inward Dial'
                });
            }
            return mockNumbers;
        }

        function populateDropdown(numbers) {
            phoneDropdown.innerHTML = '<option value="">Select a phone number...</option>';
            
            numbers.forEach(item => {
                const option = document.createElement('option');
                option.value = item.AvailablePhoneNumber;
                option.textContent = item.AvailablePhoneNumber;
                phoneDropdown.appendChild(option);
            });
        }

        function displayPhoneNumbers(numbers) {
            if (numbers.length === 0) {
                phoneList.innerHTML = '<div class="loading">No phone numbers found starting with 1414277</div>';
                return;
            }

            phoneList.innerHTML = '';
            numbers.forEach(item => {
                const numberDiv = document.createElement('div');
                numberDiv.className = 'phone-number';
                numberDiv.textContent = item.AvailablePhoneNumber;
                phoneList.appendChild(numberDiv);
            });
        }

        function selectPhoneNumber(phoneNumber) {
            selectedNumberDiv.style.display = 'block';
            selectedNumberDiv.textContent = `Selected: ${phoneNumber}`;
            showSuccess(`Phone number ${phoneNumber} has been selected.`);
            
            // Here you could make an API call to provision the selected number
            console.log('Selected phone number:', phoneNumber);
        }

        function showLoading(show) {
            if (show) {
                phoneList.innerHTML = '<div class="loading">Loading available phone numbers...</div>';
                phoneDropdown.innerHTML = '<option value="">Loading phone numbers...</option>';
            }
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            successMessage.style.display = 'none';
        }

        function showSuccess(message) {
            successMessage.textContent = message;
            successMessage.style.display = 'block';
            errorMessage.style.display = 'none';
        }

        function hideMessages() {
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
        }
    </script>
</body>
</html>
