<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MSOE Teams Phone User Provisioning</title>
  <style>
    * { margin:0; padding:0; box‑sizing:border‑box; }
    body { font-family:Arial,sans-serif; background:#f5f5f5; padding:20px; }
    .container { max-width:1400px; margin:0 auto; }
    .columns { display:flex; gap:20px; flex-wrap:wrap; margin-bottom:20px; }
    .column {
      flex:1;
      background:#e8e8e8;
      border:2px solid #999;
      border-radius:4px;
      padding:20px;
      display:flex;
      flex-direction:column;
      min-width:280px;
    }
    .column-header {
      background:#d0d0d0;
      margin:-20px -20px 20px -20px;
      padding:10px 20px;
      font-weight:bold;
      font-size:16px;
      border-bottom:1px solid #999;
    }
    .form-group { margin-bottom:15px; }
    .form-group label {
      display:block;
      margin-bottom:5px;
      font-weight:bold;
      color:#333;
    }
    .form-control {
      width:100%;
      padding:8px 12px;
      border:1px solid #999;
      border-radius:4px;
      background:#fff;
      font-size:14px;
      color:#333;
    }
    .form-control:focus {
      outline:none;
      border-color:#c41e3a;
      box-shadow:0 0 5px rgba(196,30,58,0.3);
    }
    .radio-group { display:flex; gap:15px; margin-top:5px; }
    .radio-group label { font-weight:normal; }
    .btn {
      padding:8px 15px;
      border:none;
      border-radius:4px;
      cursor:pointer;
      font-size:14px;
      margin-top:auto;
    }
    .btn-primary {
      background:#c41e3a; color:#fff;
    }
    .btn-primary:disabled {
      background:#ccc; cursor:not-allowed;
    }
    .success {
      padding:10px;
      background:#e6ffe6;
      border:1px solid #006600;
      color:#006600;
      border-radius:4px;
      margin-bottom:15px;
    }
    @media (max-width:800px) {
      .columns { flex-direction:column; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="columns">
      <!-- Column 1: Add a Teams Phone User -->
      <div class="column">
        <div class="column-header">Add a Teams Phone User</div>
        <div id="addUserMessages"></div>

        <div class="form-group">
          <label for="addUsername">Select User:</label>
          <select id="addUsername" class="form-control">
            <option value="">Loading users…</option>
          </select>
        </div>

        <div class="form-group">
          <label for="addPhoneNumber">Pick an available phone number:</label>
          <select id="addPhoneNumber" class="form-control">
            <option value="">Loading numbers…</option>
          </select>
        </div>

        <div class="form-group">
          <label>International Calling:</label>
          <div class="radio-group">
            <label><input type="radio" name="addIntlCalling" id="addIntlYes" value="yes"> Yes</label>
            <label><input type="radio" name="addIntlCalling" id="addIntlNo" value="no" checked> No</label>
          </div>
        </div>

        <!-- …any other form groups you had here… -->

        <button id="addUserSubmit" class="btn btn-primary" disabled>
          Activate Phone User
        </button>
      </div>

      <!-- Column 2: Modify a Teams Phone User -->
      <div class="column">
        <div class="column-header">Modify a Teams Phone User</div>
        <!-- your existing Modify form markup goes here unchanged -->
      </div>

      <!-- Column 3: Deprovision a Teams Phone User -->
      <div class="column">
        <div class="column-header">Deprovision a Teams Phone User</div>
        <!-- your existing Deprovision form markup goes here unchanged -->
      </div>
    </div>
  </div>

  <script>
    const API = {
      url: 'https://availablephonenumberapi.azurewebsites.net/api/GetAvailablePhoneNumbers',
      key: 'EsQlM7c0jssk1pzk83F5IYFV6SkZm6AXto3KSbXSA4JlAzFuN7cgbw=='
    };

    let phoneNumbers = [], dropdownData = null;

    document.addEventListener('DOMContentLoaded', () => {
      loadPhoneNumbers();
      document.getElementById('addUsername')
              .addEventListener('change', validateAddForm);
      document.getElementById('addPhoneNumber')
              .addEventListener('change', validateAddForm);
      document.getElementById('addUserSubmit')
              .addEventListener('click', submitAddUser);
    });

    async function loadPhoneNumbers() {
      // GET phone numbers
      const resp1 = await fetch(`${API.url}?code=${API.key}`);
      if (!resp1.ok) return console.error('Phone-number fetch failed');
      phoneNumbers = await resp1.json();
      populatePhoneDropdowns();

      // POST dropdown data
      const resp2 = await fetch(`${API.url}?code=${API.key}`, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({action:'getdropdowndata'})
      });
      if (!resp2.ok) return console.error('Dropdown fetch failed');
      dropdownData = await resp2.json();
      populateDropdowns();
    }

    function populateDropdowns() {
      // Populate "Select User"
      const userSel = document.getElementById('addUsername');
      userSel.innerHTML = '<option value="">Select a user…</option>';
      (dropdownData.a5Users||[]).forEach(u => {
        userSel.appendChild(new Option(u,u));
      });

      // …and similarly for callQueueGroups, autoAttendants, callQueues if needed…
    }

    function populatePhoneDropdowns() {
      const phoneSel = document.getElementById('addPhoneNumber');
      phoneSel.innerHTML = '<option value="">Select a phone number…</option>';
      phoneNumbers
        .filter(i => i.AvailablePhoneNumber.startsWith('1414277'))
        .forEach(i => {
          phoneSel.appendChild(new Option(i.AvailablePhoneNumber, i.AvailablePhoneNumber));
        });
    }

    function validateAddForm() {
      const u = !!document.getElementById('addUsername').value;
      const p = !!document.getElementById('addPhoneNumber').value;
      document.getElementById('addUserSubmit').disabled = !(u && p);
    }

    async function submitAddUser() {
      const body = {
        action: 'add',
        username: document.getElementById('addUsername').value,
        phoneNumber: document.getElementById('addPhoneNumber').value,
        a5Licensed: true,
        internationalCalling: document.getElementById('addIntlYes').checked,
        // …include any other arrays here…
      };
      const resp = await fetch(`${API.url}?code=${API.key}`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(body)
      });
      if (!resp.ok) {
        const err = await resp.json();
        return document.getElementById('addUserMessages').innerText = err.error;
      }
      const result = await resp.json();
      document.getElementById('addUserMessages').innerHTML =
        `<div class="success">
           User ${result.username} (${result.phoneNumber}) added!
         </div>`;
      populatePhoneDropdowns();
    }
  </script>
</body>
</html>
